<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Sorting</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400&display=swap">
    <style>
        body { 
            font-family: 'League Spartan', sans-serif; 
            text-align: center; padding: 20px; background: #f4f4f4; 
            position: relative;
        }

        .top-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        .button {
            background: #6200ea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .initial-zone { 
            display: flex; 
            align-items: center; 
            justify-content: flex-start; 
            width: 100%; 
            min-height: 40px;
            background: white; 
            padding: 10px 20px; 
            border-radius: 8px; 
            border: 2px dashed #ccc; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }

        .initial-zone h3 {
            margin: 0;
            text-align: left;
            flex-shrink: 0;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 10px;
            margin-left: 20px;
            flex-grow: 1;
        }

        .category { 
            width: 220px; 
            min-height: 250px; 
            background: white; 
            padding: 10px; 
            border-radius: 8px; 
            border: 2px dashed #ccc; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            display: flex; 
            flex-direction: column;
            align-items: center;
        }

        .add-category {
            cursor: pointer;
            font-size: 20px;
            background: #6200ea;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            margin-top: 10px;
        }

        .card { 
            background: #6200ea; 
            color: white; 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: grab; 
            width: 160px; 
            text-align: center; 
            font-size: 14px;
            transition: transform 0.2s;
        }

        .card:hover { transform: scale(1.05); }

        .dragging { opacity: 0.5; }
    </style>
</head>
<body>
    <div class="top-buttons">
        <button class="button" id="finish-button">Terminar</button>
        <button class="button" id="whatsapp-button">WhatsApp</button>
    </div>

    <h2>Card Sorting Session</h2>
    <p>Arrastra las tarjetas a las categorías o regrésalas a la zona inicial.</p>

    <div class="initial-zone" id="initial-zone" data-category="initial-zone">
        <h3>Zona de Inicio</h3>
        <div class="cards-container" id="cards-container"></div>
    </div>

    <div class="container" id="categories-container"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let freeform = urlParams.get("freeform") === "1";
        let categorias = urlParams.get("categorias")?.split(",") || [];
        const tarjetas = urlParams.get("tarjetas")?.split(",") || [];
        
        if (freeform) {
            categorias = categorias.filter(cat => cat !== "freeform");
        }
        
        const container = document.getElementById("categories-container");
        const initialZone = document.getElementById("cards-container");

        function renderCategories() {
            container.innerHTML = "";
            categorias.forEach(categoria => {
                const div = document.createElement("div");
                div.classList.add("category");
                div.setAttribute("data-category", categoria);
                div.innerHTML = `<h3>${categoria}</h3>`;
                div.addEventListener("dragover", e => e.preventDefault());
                div.addEventListener("drop", e => handleDrop(e, div));
                container.appendChild(div);
            });

            if (freeform) {
                const addCategoryBtn = document.createElement("button");
                addCategoryBtn.classList.add("add-category");
                addCategoryBtn.innerText = "+";
                addCategoryBtn.onclick = addNewCategory;
                container.appendChild(addCategoryBtn);
            }
        }

        function renderCards() {
            initialZone.innerHTML = "";
            tarjetas.forEach(texto => {
                const card = document.createElement("div");
                card.classList.add("card");
                card.innerText = texto;
                card.draggable = true;
                card.addEventListener("dragstart", e => { e.dataTransfer.setData("text", texto); card.classList.add("dragging"); });
                card.addEventListener("dragend", () => card.classList.remove("dragging"));
                initialZone.appendChild(card);
            });
        }

        function handleDrop(e, target) {
            e.preventDefault();
            const text = e.dataTransfer.getData("text");
            const card = [...document.querySelectorAll(".card")].find(c => c.innerText === text);
            if (card) target.appendChild(card);
        }

        function addNewCategory() {
            const newCategory = prompt("Nombre de la nueva categoría:");
            if (newCategory) {
                categorias.push(newCategory);
                const newParams = new URLSearchParams(window.location.search);
                newParams.set("freeform", "1");
                newParams.set("categorias", categorias.join(","));
                window.history.replaceState(null, "", "?" + newParams.toString());
                renderCategories();

            }
        }

        renderCategories();
        renderCards();
    </script>
</body>
</html>